insert into rec_race_gap 
select 
  race.ymd, race.jyocd, race.raceno, 
  nationwiningrate1 - nationwiningrate2,
  nationwiningrate1 - nationwiningrate3,
  nationwiningrate1 - nationwiningrate4,
  nationwiningrate2 - nationwiningrate3,
  nationwiningrate2 - nationwiningrate4,
  nationwiningrate3 - nationwiningrate4,
  localwiningrate1 - localwiningrate2,
  localwiningrate1 - localwiningrate3,
  localwiningrate1 - localwiningrate4,
  localwiningrate2 - localwiningrate3,
  localwiningrate2 - localwiningrate4,
  localwiningrate3 - localwiningrate4,
  waku2.motor2winingrate1 - waku2.motor2winingrate2,
  waku2.motor2winingrate1 - waku2.motor2winingrate3,
  waku2.motor2winingrate1 - waku2.motor2winingrate4,
  waku2.motor2winingrate2 - waku2.motor2winingrate3,
  waku2.motor2winingrate2 - waku2.motor2winingrate4,
  waku2.motor2winingrate3 - waku2.motor2winingrate4,
  avgst1 - avgst2,
  avgst1 - avgst3,
  avgst1 - avgst4,
  avgst2 - avgst3,
  avgst2 - avgst4,
  avgst3 - avgst4,
  avgtime1 - avgtime2,
  avgtime1 - avgtime3,
  avgtime1 - avgtime4,
  avgtime2 - avgtime3,
  avgtime2 - avgtime4,
  avgtime3 - avgtime4
--   racerwiningrate1 - racerwiningrate2,
--   racerwiningrate1 - racerwiningrate3,
--   racerwiningrate1 - racerwiningrate4,
--   racerwiningrate2 - racerwiningrate3,
--   racerwiningrate2 - racerwiningrate4,
--   racerwiningrate3 - racerwiningrate4,
--   motorwiningrate1 - motorwiningrate2,
--   motorwiningrate1 - motorwiningrate3,
--   motorwiningrate1 - motorwiningrate4,
--   motorwiningrate2 - motorwiningrate3,
--   motorwiningrate2 - motorwiningrate4,
--   motorwiningrate3 - motorwiningrate4
from rec_race race, rec_race_waku waku, rec_race_waku2 waku2, stat_waku_win wakuwin
where 
  race.ymd = waku.ymd and race.jyocd = waku.jyocd and race.raceno = waku.raceno
  and race.ymd = waku2.ymd and race.jyocd = waku2.jyocd and race.raceno = waku2.raceno
  and race.ymd = wakuwin.ymd and race.jyocd = wakuwin.jyocd and race.raceno = wakuwin.raceno
;

drop table if exists rec_race_gap;
create table rec_race_gap (
ymd varchar(8),
jyocd varchar(2),
raceno smallint,
nationwining12 numeric(5,2),
nationwining13 numeric(5,2),
nationwining14 numeric(5,2),
nationwining15 numeric(5,2),
nationwining16 numeric(5,2),
nationwining23 numeric(5,2),
nationwining24 numeric(5,2),
nationwining25 numeric(5,2),
nationwining26 numeric(5,2),
nationwining34 numeric(5,2),
nationwining35 numeric(5,2),
nationwining36 numeric(5,2),
nationwining45 numeric(5,2),
nationwining46 numeric(5,2),
nationwining56 numeric(5,2),
localwining12 numeric(5,2),
localwining13 numeric(5,2),
localwining14 numeric(5,2),
localwining23 numeric(5,2),
localwining24 numeric(5,2),
localwining34 numeric(5,2),
motor2wining12 numeric(5,2),
motor2wining13 numeric(5,2),
motor2wining14 numeric(5,2),
motor2wining23 numeric(5,2),
motor2wining24 numeric(5,2),
motor2wining34 numeric(5,2),
avgst12 numeric(5,2),
avgst13 numeric(5,2),
avgst14 numeric(5,2),
avgst23 numeric(5,2),
avgst24 numeric(5,2),
avgst34 numeric(5,2),
avgtime12 numeric(5,2),
avgtime13 numeric(5,2),
avgtime14 numeric(5,2),
avgtime23 numeric(5,2),
avgtime24 numeric(5,2),
avgtime34 numeric(5,2)
-- racerwining12 numeric(5,2),
-- racerwining13 numeric(5,2),
-- racerwining14 numeric(5,2),
-- racerwining23 numeric(5,2),
-- racerwining24 numeric(5,2),
-- racerwining34 numeric(5,2),
-- motorwining12 numeric(5,2),
-- motorwining13 numeric(5,2),
-- motorwining14 numeric(5,2),
-- motorwining23 numeric(5,2),
-- motorwining24 numeric(5,2),
-- motorwining34 numeric(5,2)
);
create index indexes_rec_race_gap on rec_race_gap (ymd, jyocd, raceno);

